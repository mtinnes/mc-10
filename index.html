<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en" xmlns:fb="https://ogp.me/ns/fb#">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="Tandy MC-10 Emulator in Javascript">
    <meta name="keywords"
        content="Tandy, mc-10, mc10, emulator, emulation, javascript, trs-80, trs80, radio shack, radioshack">
    <meta name="viewport" content="width=device-width">
    <title>MC-10 Javascript Emulator</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <script src="https://kit.fontawesome.com/5f89775b0b.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@100;400&family=Press+Start+2P&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="mc10.css?v=6">
    <script src="//apis.google.com/js/platform.js" async defer></script>
    <script src="//unpkg.com/eta" type="module" async defer></script>
    <meta property="og:title" content="MC-10 Emulator in Javascript" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://mc-10.com/images/mc10_ss.jpg" />
    <meta property="og:url" content="https://mc-10.com" />
    <meta property="og:site_name" content="MC-10 Javascript Emulator" />
    <meta property="fb:admins" content="701869110" />
</head>

<body>
    <div id="fb-root"></div>
    <script>
        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=202303830100&version=v2.0";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));</script>
    <!--[if lt IE 7]><p class=chromeframe>Your browser is <em>ancient!</em> <a href="https://browsehappy.com/">Upgrade to a different browser</a> or <a href="https://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p><![endif]-->
    <div id="tv">
        <canvas id="screen" width="512" height="384">
            Your browser is not supported. Try Google Chrome.
        </canvas>
        <div id="controls">
            <input id="reset" type="button" value="Reset" />
            <input type="button" id="record" value="Start Record" />
            <input type="button" id="debug" value="Debugger" />
            <input type="file" id="wavcassette" name="wavcassette" />
            <select id="cassetteList" name="cassetteList">
                <option value="">- Select Cassette -</option>
                <optgroup label="CoCo Ports">
                    <option value="ML/SPACEASSAULT.c10">Space Assault [Type EXEC to start]</option>
                    <option value="ML/GUNTUS.c10">Guntas [Type EXEC to start]</option>
                </optgroup>
                <optgroup label="Darren Atkinson">
                    <option value="ML/ASTROIDS.c10">Asteroids [Type EXEC to start]</option>
                    <option value="ML/MC_BOUNCY_BALL.c10">MC Bouncy Ball [Type EXEC to start]</option>
                    <option value="ML/MC_FLAGON_BIRD.c10">MC Flagon Bird [Type EXEC to start]</option>
                </optgroup>
                <optgroup label="Greg Dionne">
                    <option value="ML/PAC-Man.C10">Pac-Man [Type EXEC to start]</option>
                    <option value="ML/TETRIS.C10">Tetris [Type EXEC to start]</option>
                    <option value="ML/KALEIDOSCOPE.C10">Kaleidoscope [Type EXEC to start]</option>
                    <option value="ML/RG2LIFE.C10">Conway's Life [Type EXEC to start]</option>
                </optgroup>
                <optgroup label="Tandy">
                    <option value="ML/PINBALL.C10">Pinball [Type EXEC to start]</option>
                    <option value="BASIC/MINICALC.C10">Minicalc [Type RUN to start]</option>
                    <option value="BASIC/CHECKERS.C10">Checkers [Type RUN to start]</option>
                    <option value="BASIC/BREAKOUT.C10">Breakout [Type RUN to start]</option>
                    <option value="BASIC/EGGS.C10">Eggs [Type RUN to start]</option>
                    <option value="BASIC/HORSE.C10">Horse [Type RUN to start]</option>
                    <option value="BASIC/LANDER.C10">Lander [Type RUN to start]</option>
                    <option value="BASIC/PONG.C10">Pong [Type RUN to start]</option>
                </optgroup>
                <optgroup label="Charles Pelosi">
                    <option value="BASIC/DEMON_ATTACK.C10">Demon Attack [Type RUN to start]</option>
                    <!--<option value="aster64.C10">Aster64 (Charles Pelosi)</option>-->
                    <option value="BASIC/BLOCK_DROP.C10">Block Drop [Type RUN to start]</option>
                    <option value="BASIC/DEFEND.C10">Defend [Type RUN to start]</option>
                    <option value="BASIC/DRAGON_CASTLES.C10">Dragon Castles [Type RUN to start]</option>
                    <option value="BASIC/FREEWAY.C10">Freeway [Type RUN to start]</option>
                    <option value="BASIC/ROADRACE.C10">Roadrace [Type RUN to start]</option>
                </optgroup>
                <optgroup label="Jim Gerrie">
                    <option value="BASIC/CRAWL.C10">Crawl [Type RUN to start]</option>
                    <option value="BASIC/MAHJONG.C10">Mahjong [Type RUN to start]</option>
                    <option value="BASIC/KLONDIKE.C10">Klondike [Type RUN to start]</option>
                    <option value="BASIC/PITMAN.C10">Pitman [Type RUN to start]</option>
                    <option value="BASIC/BERZERK.C10">Berzerk [Type RUN to start]</option>
                    <option value="BASIC/CAVE3D.C10">Cave 3D [Type RUN to start]</option>
                    <option value="BASIC/CHESS.C10">Chess [Type RUN to start]</option>
                    <option value="BASIC/FROG.C10">Frog [Type RUN to start]</option>
                    <option value="BASIC/INVADER.C10">Invader [Type RUN to start]</option>
                    <option value="BASIC/LANDERJG.C10">Lander [Type RUN to start]</option>
                    <option value="BASIC/ROVER.C10">Rover [Type RUN to start]</option>
                    <option value="BASIC/PENGUINO.C10">Penguino [Type RUN to start]</option>
                </optgroup>
                <optgroup label="Other">
                    <option value="BASIC/LEAPFROG.C10">Leapfrog [Type RUN to start]</option>
                    <option value="BASIC/KALEIDOA.C10">Kaleidoscope [Type RUN to start]</option>
                    <option value="ML/PUMPKIN.C10">Pumpkin Patch [Type EXEC to start]</option>
                </optgroup>
            </select>
        </div>
        <div id="about">
            Copyright 2022 Â© <a href="https://github.com/mtinnes">
                Mike
                Tinnes
            </a>
        </div>
        <div id="babble-container">
            <div class="babble">
                <h2>
                    MC-10 Emulator
                </h2>
                <p>
                    Yet another javascript emulator, this time for the legendary *ahem* <a
                        href="https://en.wikipedia.org/wiki/TRS-80_MC-10">
                        MC-10 microcomputer
                    </a> by Tandy Corp!
                </p>
                <p>
                    Purely the result of one persons (me) sentimental journey
                    into his childhood days of PEEK'ing and POKE'ing. Source is available on <a
                        href="https://github.com/mtinnes/mc-10">GitHub</a>.
                </p>
                <h3>
                    Shameless Plug
                </h3>
                <p>
                    <a href="https://www.catalystllc.biz">https://www.catalystllc.biz</a>
                </p>
                <p>
                    <fb:like href="https://mc-10.com" layout="standard" action="like" show_faces="true" share="true">
                    </fb:like>
                </p>
                <p>
                    <g:plusone></g:plusone>
                </p>
                <p>
                    <a class="github-button" href="https://github.com/mtinnes">Follow @mtinnes</a>
                    <a class="github-button" href="https://github.com/mtinnes/mc-10"
                        aria-label="Star mtinnes/mc-10 on GitHub">Star</a>
                </p>
            </div>
            <div class="babble">
                <h3>
                    How to do it...
                </h3>
                <p>
                    The keyboard is mapped directly to the original MC-10 <b>physical layout</b> so
                    you'll have to reference <a href="/images/139100-trs80.jpg" target="_blank">this</a>.
                    Use the file button to upload .C10 cassette files or select one from the list.
                </p>
                <p>
                    Use Shift+0 to toggle between upper and lowercase characters.
                </p>
                <p>
                    Use Control+0 to cycle the cursor amongst the various colors.
                </p>
                <p>
                    Use Shift+@ to pause a BASIC program. Press any other key to resume.
                </p>
                <p>
                    Use ESC to emulate the BREAK key.
                </p>
                <p>
                    The "Start Record" button can be pressed before typing CSAVE or CSAVE*. You'll get prompted for a
                    filename once it's all done. It saves as a .c10 file.
                </p>
                <p>
                    "Choose File" will start typing a text file in BASIC. If the file is a .c10 or a .wav file it will
                    instead emulate reading it via cassette. (You will need to previously enter a CLOAD, CLOADM, or
                    CLOAD* command).
                </p>
            </div>
        </div>
    </div>
    <form id="download-form" method="post" action="/SaveCassette.ashx">
        <input type="hidden" id="cassette-data" name="cassette-data" />
        <input type="hidden" id="filename" name="filename" />
    </form>

    <div id="debugger">
        <div id="header">
            <h2><i class="fa-sharp fa-solid fa-bugs"></i> Debugger</h2>
            <div id="close">
                <i class="fa-sharp fa-solid fa-rectangle-xmark"></i>
            </div>
        </div>
        <div id="history">
        </div>
        <div id="debugcontrols">
            <button onclick="mc10.pause()"><i class="fa-sharp fa-solid fa-pause"></i> Break</button>
            <button onclick="mc10.step()">Step</button>
            <button onclick="mc10.run()"><i class="fa-sharp fa-solid fa-play"></i> Run</button>
        </div>
    </div>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"
        integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="//code.jquery.com/ui/1.13.2/jquery-ui.min.js"
        integrity="sha256-lSjKY0/srUM9BE3dPm+c4fBo1dky2v27Gdjm2uoZaL0=" crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="js/libs/jquery-1.7.1.min.js"><\/script>')</script>
    <script src="MC10.js?v=1" type="text/javascript"></script>
    <script type="text/javascript">
        var mc10 = new MC10({
            maxRam: 0x8fff,
            onDebug: function () {
                debug();
            }
        });
        var charBuffer = [];
        var idx = 0;

        var historyTemplate = '<table> \
            <thead> \
                <tr> \
                    <th></th> \
                    <th>Cycle</th> \
                    <th>PC</th> \
                    <th>Inst</th> \
                    <th>Flags</th> \
                </tr> \
            </thead> \
            <tbody id="instructions"> \
                <% it.forEach(item => { %> \
                    <tr> \
                        <td class="icon"><div></div></td> \
                        <td class="cycle"><%= item.diffCycle %></td> \
                        <td class="pc"><%= item.pc %></td> \
                        <td class="inst"><%= item.inst %></td> \
                        <td class="flags"><%~ include("flags", item) %></td> \
                    </tr> \
                <% }) %> \
            </tbody> \
        </table>';

        var flagsTemplate = '<div id="flags"> \
            <% if (it.flags.c === 1) { %><div class="set">C</div><% } else { %><div>.</div><% } %> \
            <% if (it.flags.o === 1) { %><div class="set">V</div><% } else { %><div>.</div><% } %> \
            <% if (it.flags.z === 1) { %><div class="set">Z</div><% } else { %><div>.</div><% } %> \
            <% if (it.flags.s === 1) { %><div class="set">N</div><% } else { %><div>.</div><% } %> \
            <% if (it.flags.i === 1) { %><div class="set">I</div><% } else { %><div>.</div><% } %> \
            <% if (it.flags.h === 1) { %><div class="set">H</div><% } else { %><div>.</div><% } %> \
            </div>';

        //jQuery.event.props.push('dataTransfer');

        $(document).bind('dragover dragend', function (e) {
            return false;
        });

        $(document).bind("keydown keypress", function (e) {
            if (e.which == 8 || e.which == 32) { // 8 == backspace, 32 == spacebar
                e.preventDefault();
            }
        });

        $("#reset").bind("click", function (e) {
            mc10.reset();
        });

        $("#paste").bind("click", function (e) {
        });

        $("#debug, #close").bind("click", function (e) {
            var toggle = mc10.toggleDebug();
            if (toggle) {
                $("#debugger").show();
            } else {
                $("#debugger").hide();
                mc10.run();
            }
        });

        $("#wavcassette").bind("change", function (e) {
            handleWavFileSelect(e);
        });

        $("#cassetteList").bind("change", function (e) {
            loadCassette();
        });

        $("#record").bind("click", function (e) {
            mc10.record(function (buffer) {
                var fname = prompt("Filename?");
                clientDownload(fname + '.c10', buffer);
            });
        });

        $(document).ready(function () {
            mc10.reset();
            mc10.run();

            $("#debugger").draggable({ handle: "#header" });
        });

        function debug() {
            if (Eta !== undefined) {
                Eta.templates.define('flags', Eta.compile(flagsTemplate));

                var html = Eta.render(historyTemplate, mc10.historyBuffer.slice().reverse());
                document.getElementById('history').innerHTML = html;
            }
        }

        function arrayBufferToBase64(buffer) {
            var binary = ''
            var bytes = new Uint8Array(buffer)
            var len = bytes.byteLength;
            for (var i = 0; i < len; i++) {
                binary += String.fromCharCode(bytes[i])
            }
            return window.btoa(binary);
        }

        function clientDownload(filename, buffer) {
            var element = document.createElement('a');
            element.setAttribute('href', 'data:application/octet-stream;base64,' + encodeURIComponent(arrayBufferToBase64(buffer)));
            element.setAttribute('download', filename);

            element.style.display = 'none';
            document.body.appendChild(element);

            element.click();

            document.body.removeChild(element);
        }

        function handleWavFileSelect(evt) {
            var reader = new FileReader();
            var wavReader = function (e) {
                var buffer = reader.result;
                var audioContext = new AudioContext();
                audioContext.decodeAudioData(buffer, function (decoded) {
                    var typedArray = decoded.getChannelData(0);
                    mc10.cassette.playWav(decoded.sampleRate, typedArray);

                });
            };
            var c10Reader = function (e) {
                var buffer = reader.result;
                mc10.cassette.playC10(buffer);
            };
            var txtReader = function (e) {
                var buffer = reader.result;
                mc10.keyboard.quicktype(buffer);
            }
            var playfile = evt.target.files[0];
            var filetype = playfile.name.split('.').pop().toLowerCase();
            reader.onload = filetype == 'wav' ? wavReader :
                filetype == 'c10' ? c10Reader :
                    txtReader;
            reader.readAsArrayBuffer(playfile);
        }

        function loadCassette() {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "/cassettes/" + $("#cassetteList").val().toUpperCase(), true);
            xhr.responseType = "arraybuffer";
            xhr.onload = function (e) {
                if (this.status == 200) {
                    mc10.loadDirect(this.response);
                }
            };
            xhr.send();
        }
    </script>
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
                m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-880433-14', 'auto');
        ga('send', 'pageview');
    </script>
    <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>
</body>

</html>